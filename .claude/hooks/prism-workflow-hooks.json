{
  "name": "PRISM项目工作流Hooks",
  "version": "1.0.0",
  "description": "PRISM项目自动化工作流钩子配置，实现三角色协作的无缝衔接",
  "hooks": [
    {
      "name": "方案文档监控器",
      "description": "当算法分析师创建新方案文档后，自动拉起质检者进行方案评估",
      "enabled": true,
      "trigger": {
        "type": "file_change",
        "pattern": "docx/记录点*/记录点*方案*",
        "events": ["created", "modified"]
      },
      "action": {
        "type": "agent_message",
        "agent": "质检者",
        "message": "算法分析师已提交新方案，请进行方案质量评估。按照agent-inspector.md中的检查点A流程评估方案：1) 读取新创建的方案文档 2) 进行理论深度、创新性、可行性、风险可控性、预期收益的多维评分 3) 做出决策并写入对应hook文件触发下一步：通过→写入hook/solution_pass.txt，不通过→写入hook/solution_reject.txt"
      }
    },
    {
      "name": "训练完成监控器",
      "description": "当训练完成后（train.txt被创建），自动拉起质检者评估训练结果",
      "enabled": true,
      "trigger": {
        "type": "file_change",
        "pattern": "./hook/train.txt",
        "events": ["created"]
      },
      "action": {
        "type": "agent_message",
        "agent": "质检者",
        "message": "训练已完成（./hook/train.txt 已创建）。请以质检者身份，按照agent-inspector.md中的检查点B流程评估训练结果：1) 读取 save_model/baseline/log/ 最新日志 2) 分析收敛性、过拟合、数值稳定性 3) 做出决策并写入对应hook文件触发下一步：正常→写入hook/train_pass.txt，过拟合/退化→写入hook/train_redesign.txt，技术异常→写入hook/train_fix.txt"
      }
    },
    {
      "name": "预测完成监控器",
      "description": "当预测完成后（predict.txt被创建），自动拉起算法分析师分析结果",
      "enabled": true,
      "trigger": {
        "type": "file_change",
        "pattern": "./hook/predict.txt",
        "events": ["created"]
      },
      "action": {
        "type": "agent_message",
        "agent": "算法分析师",
        "message": "预测已完成（./hook/predict.txt 已创建）。请以算法分析师身份分析预测结果，判断是否达标：1) 读取compete/{SAVEMODEL_NAME}/预测结果 2) 分析各细胞系AUPR/AUC 3) 与AUPR≥0.75目标对比 4) 做出决策：达标→更新历史索引标记完成，不达标→撰写反思文档+设计新方案"
      }
    },
    {
      "name": "方案通过触发器",
      "description": "当质检者通过方案评估后（solution_pass.txt被创建），自动拉起方案执行者",
      "enabled": true,
      "trigger": {
        "type": "file_change",
        "pattern": "./hook/solution_pass.txt",
        "events": ["created"]
      },
      "action": {
        "type": "agent_message",
        "agent": "方案执行者",
        "message": "方案已通过质检（./hook/solution_pass.txt 已创建）。请以方案执行者身份开始代码实现和实验执行：1) 深度理解方案文档 2) 代码实现 3) 代码验证 4) 版本控制 5) 执行训练"
      }
    },
    {
      "name": "方案拒绝触发器",
      "description": "当质检者拒绝方案评估后（solution_reject.txt被创建），自动拉起算法分析师重新设计",
      "enabled": true,
      "trigger": {
        "type": "file_change",
        "pattern": "./hook/solution_reject.txt",
        "events": ["created"]
      },
      "action": {
        "type": "agent_message",
        "agent": "算法分析师",
        "message": "方案被质检者拒绝（./hook/solution_reject.txt 已创建）。请以算法分析师身份重新分析问题并提出新的解决方案：1) 分析拒绝原因 2) 重新进行问题诊断 3) 设计新方案"
      }
    },
    {
      "name": "训练通过触发器",
      "description": "当质检者评估训练正常后（train_pass.txt被创建），自动拉起方案执行者执行预测",
      "enabled": true,
      "trigger": {
        "type": "file_change",
        "pattern": "./hook/train_pass.txt",
        "events": ["created"]
      },
      "action": {
        "type": "agent_message",
        "agent": "方案执行者",
        "message": "训练评估正常（./hook/train_pass.txt 已创建）。请以方案执行者身份执行预测流程：执行predict.py进行预测"
      }
    },
    {
      "name": "训练修复触发器",
      "description": "当质检者发现训练技术异常后（train_fix.txt被创建），自动拉起方案执行者修复重训",
      "enabled": true,
      "trigger": {
        "type": "file_change",
        "pattern": "./hook/train_fix.txt",
        "events": ["created"]
      },
      "action": {
        "type": "agent_message",
        "agent": "方案执行者",
        "message": "训练发现技术异常（./hook/train_fix.txt 已创建）。请以方案执行者身份修复问题并重新训练：1) 分析异常原因 2) 修复代码问题 3) 重新执行训练"
      }
    },
    {
      "name": "训练重新设计触发器",
      "description": "当质检者发现训练过拟合或退化后（train_redesign.txt被创建），自动拉起算法分析师重新设计",
      "enabled": true,
      "trigger": {
        "type": "file_change",
        "pattern": "./hook/train_redesign.txt",
        "events": ["created"]
      },
      "action": {
        "type": "agent_message",
        "agent": "算法分析师",
        "message": "训练发现过拟合或退化（./hook/train_redesign.txt 已创建）。请以算法分析师身份重新设计方案：1) 分析过拟合/退化原因 2) 重新进行问题诊断 3) 设计新方案"
      }
    },
    {
      "name": "项目启动触发器",
      "description": "手动启动或达标失败后，激活算法分析师开始新一轮分析",
      "enabled": true,
      "trigger": {
        "type": "manual",
        "command": "start_prism_iteration"
      },
      "action": {
        "type": "agent_message",
        "agent": "算法分析师",
        "message": "开始新一轮PRISM优化迭代，请分析当前问题并设计解决方案。目标：AUPR≥0.75"
      }
    }
  ],
  "execution_logic": {
    "automation_flow": [
      "文件监控：持续监控关键文件的变化",
      "条件匹配：检查触发条件是否满足",
      "Agent激活：向指定Agent发送激活消息",
      "状态跟踪：记录Hook执行历史和状态"
    ],
    "error_handling": {
      "hook_failure": "如果Hook未能正确触发，提供手动激活机制",
      "duplicate_triggering": "防止同一事件重复触发Hook",
      "exception_recovery": "Hook执行异常时的恢复机制"
    },
    "debug_mode": {
      "logging": "记录所有Hook触发和执行情况",
      "manual_testing": "提供手动触发Hook的测试接口",
      "status_query": "查询当前Hook状态和历史记录"
    }
  },
  "special_scenarios": {
    "training_abnormal_interruption": {
      "handling_method": [
        "检测训练日志中的异常关键词（NaN, OOM, Error）",
        "立即触发质检者评估",
        "质检者判断是否需要方案执行者修复或算法分析师重新设计"
      ]
    },
    "long_time_no_response": {
      "handling_method": [
        "设置超时机制（如24小时无新文件）",
        "自动发送提醒消息给相应Agent",
        "提供手动干预接口"
      ]
    },
    "stability_verification_after_meeting_target": {
      "handling_method": [
        "连续3次达标后进入稳定性验证模式",
        "自动触发多次重复实验",
        "确认稳定性后正式完成项目"
      ]
    }
  },
  "current_status": {
    "active_hooks": 9,
    "monitored_files": ["docx/记录点*/", "log/记录点*", "./hook/*.txt"],
    "next_expected_trigger": "根据记录点15状态确定"
  },
  "maintenance": {
    "regular_check": "每周检查Hook配置的有效性",
    "performance_optimization": "优化文件监控的性能开销",
    "rule_updates": "根据项目进展更新Hook规则"
  }
}