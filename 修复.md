**诊断**
- CBAT的两阶段结构在固定阈值下系统性推高概率，表现为 Recall显著上升而 AUPR/AUC下降；根因来自强归纳偏置叠加：二维重排+块因果掩码、Top‑k稀疏选择、双门控凸融合，导致“覆盖友好、排序不稳”。
- 现实现仅做 `E←P`，并将 `E→E` 自注意显式屏蔽；模块一的块级因果掩码与跨序掩码叠加后，长程跨序对齐信息可能受限，进而损害全局排名。

**改造目标**
- 在未见细胞系上稳定提升 AUPR/AUC（阈值无关指标），并保持跨域鲁棒性。
- 保留“跨序交互优先”的设计，但削弱导致概率整体上移、排名破坏的结构性偏置。

**结构建议**
- 前端表示（替代2D重排）
  - 使用一维多尺度可分离卷积金字塔（短/中/长核的并行分支）替代 `[B,L,D]→[B,D,H,W]` 二维重排，避免网格化假设对序列语义的扭曲。
  - 在金字塔分支输出后做轻量融合（LayerNorm→线性→GELU），输出仍为 `[B,L,D]`，与后续RoPE/注意力完全兼容。

- 注意力掩码（“局部+全局”混合而非固定块因果）
  - 将固定“块级因果掩码”替换为“因果窗口 + 全局锚点”混合：
    - 窗口注意力：针对 `E` 侧，启用中等宽度的滑动窗口（如 64–128）保障局部依赖与数值稳定；
    - 全局锚点：为 `P` 序列引入1–4个全局锚点（由 `P` 的序列汇聚得到），允许 `E` 全局访问这些锚点，弥补远程对齐与跨域泛化。
  - 保持 `E→E` 屏蔽；允许 `E` 访问 `P` 的锚点和近邻窗口，避免纯块掩码带来的硬边界。

- 双向协同（对称跨序）  
  - 引入对称 `P←E` 分支，与 `E←P` 并行计算，以共享或轻量解耦的参数；在输出端通过温控门控（见下一条）进行凸融合。
  - 这样在未见细胞系上，若某一方向的对齐因分布偏移变弱，另一方向可补偿，提升 AUPR/AUC 的稳健性。

- 稀疏选择软化（替代硬 Top‑k）
  - 将硬 Top‑k 选择改为“温度退火的稀疏激活”（如 soft‑topk/entmax 类行为）：训练早期用更平滑的分布，逐步提高稀疏度，但不将未选token输出完全置零。
  - 目的：保持排序信息的连续性，避免 Scatter 零填导致非选token的贡献全失，从而改善 AUPR/AUC。

- 门控与残差（抑制饱和上移）
  - 在 `gate_1/gate_2` 前后加入预归一化与温度控制（LayerNorm→线性→Sigmoid，低温区间），限制门控输出靠近 0/1 的饱和，避免整体概率上移。
  - 引入 ReZero/LayerScale 风格的小系数残差，确保融合后的分布不会在训练后期系统性升温。

- 输出与池化（排序敏感）
  - 在 `SequencePooling` 后新增“锚点引导池化”：用全局锚点对 `E` 的权重做二次校正，减少单纯 softmax 池化带来的峰值放大。
  - 分类头前加入温度标度（可学习标度），专门针对排序一致性优化；在训练中以排名损失或 AUPR surrogate 做辅优化（不依赖固定阈值）。

- RoPE与尺度稳定性
  - 检查 RoPE 的 scaling 与训练长度配置，保持在未见长序列上频率线性缩放；对多尺度卷积分支的输出做统一位置调制，避免位置/结构双重调制叠加放大。

**鲁棒性建议（跨细胞）**
- 方向性一致性约束：在双向协同的输出上加轻量的一致性正则，使 `E←P` 与 `P←E` 在未见细胞上仍保持排序一致的“下限”。
- 域不变锚点：锚点的构造不依赖细胞系标签，仅来自 `P` 的序列统计，利用RoPE后池化的稳健成分，降低细胞域特异噪声进入跨序通道。
- 归一化与谱约束：在注意力权重与门控前后使用 LayerNorm/加性偏置方式，配合轻量谱约束，稳定跨域的数值范围，提升 AUPR/AUC 的可迁移性。

**预期效果**
- 取消2D重排与固定块掩码的硬边界后，跨序信号以“局部窗口+全局锚点”传播，增强长程对齐与未见域的泛化，AUPR/AUC上升。
- 软稀疏与温控门控保留排序信息、抑制概率整体上移；双向协同提供稳定的下限性能，在不熟悉的细胞系上更稳。
- 阈值相关指标（Precision/Recall/F1）可事后校准；但即使不调阈值，上述结构也会天然改善排名类指标，兑现“鲁棒性超越标准 cross attn”的目标。

如需，我可以按上述方向逐步做消融与可视化验证，确保每一条改造对 AUPR/AUC 的贡献明确，再决定上线顺序与参数范围。