# PRISM三角色协作系统使用指南

## 系统概述
本系统实现了PRISM项目的自动化协作工作流，通过算法分析师、方案执行者、质检者三个专门化Agent的协作，高效推进项目至AUPR≥0.75目标。

## 快速启动

### 1. 系统初始化
```bash
# 确保所有Agent配置文件就位
ls .kiro/steering/agent-*.md

# 启动Hook监控系统
kiro hook start prism-workflow
```

### 2. 开始新一轮迭代
```bash
# 手动触发项目启动（如果是首次启动或需要重新开始）
kiro hook trigger 项目启动触发器
```

### 3. 监控进展
```bash
# 查看Hook状态
kiro hook status

# 查看当前记录点
ls docx/记录点*/

# 查看训练日志
ls log/记录点*
```

## 工作流详解

### 阶段1：问题分析与方案设计
**负责Agent**：算法分析师
**输入**：历史记录、基线结果、训练日志
**输出**：`docx/记录点(n+1)/记录点(n+1)方案.md`
**触发下一步**：文件创建自动触发质检者

### 阶段2：方案质量评估
**负责Agent**：质检者
**输入**：新方案文档、历史方案对比
**输出**：质检报告（通过/不通过）
**触发下一步**：
- 通过 → 激活方案执行者
- 不通过 → 要求算法分析师重新设计

### 阶段3：代码实现与训练
**负责Agent**：方案执行者
**输入**：通过质检的方案文档
**输出**：
- 修改后的代码文件
- `log/记录点(n+1)训练日志.log`
**触发下一步**：训练日志生成自动触发质检者

### 阶段4：训练结果评估
**负责Agent**：质检者
**输入**：训练日志
**输出**：训练评估报告
**触发下一步**：
- 正常 → 继续预测流程
- 异常/过拟合 → 要求重新设计或修复

### 阶段5：预测与最终验收
**负责Agent**：方案执行者 + 质检者
**输入**：训练完成的模型
**输出**：`log/记录点(n+1)预测结果.txt`
**最终判断**：
- AUPR≥0.75 → 项目成功
- AUPR<0.75 → 开始下一轮迭代

## Agent角色说明

### 算法分析师 (agent-analyst.md)
- **专长**：深度学习理论、生物信息学、数学建模
- **职责**：问题诊断、创新方案设计、理论支撑
- **激活时机**：项目启动、方案被拒、训练异常、验收失败

### 方案执行者 (agent-executor.md)
- **专长**：PyTorch实现、代码工程、实验执行
- **职责**：代码实现、版本管理、训练预测、结果记录
- **激活时机**：方案通过质检、需要修复重训、执行预测

### 质检者 (agent-inspector.md)
- **专长**：客观评估、标准制定、流程控制
- **职责**：方案评估、训练监控、流程决策
- **激活时机**：方案提交后、训练完成后（自动触发）

## 防错机制

### 1. 协同造假防护
- 质检者独立评估，不受其他Agent影响
- 基于客观数据和标准进行判断
- 强制历史方案对比，防止重复

### 2. 质量保证
- 方案必须通过创新性≥6分 且 可行性≥7分
- 训练必须满足收敛、效率、稳定性标准
- 最终验收严格按照AUPR≥0.75标准

### 3. 效率优化
- 快速识别低质量方案，避免无效实验
- 早期发现训练异常，及时中断
- 并行化可能的工作流程

## 当前项目状态

### 基本信息
- **当前记录点**：15
- **目标AUPR**：≥0.75
- **当前最佳**：约0.72（记录点4）
- **主要挑战**：S1 vs S2竞争失效、细胞系泛化

### 历史方案总结
- **记录点4**：环境解耦方法，AUPR约0.72
- **记录点8**：蒸馏学习，模式坍缩失败
- **记录点15**：作弊者+上下文感知（进行中）

### 下一步计划
1. 评估记录点15的训练结果
2. 根据评估结果决定是否需要记录点16
3. 持续迭代直至达标

## 故障排除

### 常见问题
1. **Hook未触发**：检查文件路径和权限，手动触发测试
2. **Agent无响应**：检查Agent配置文件，重启系统
3. **训练异常**：查看详细日志，分析具体错误原因

### 手动干预
```bash
# 手动激活算法分析师
kiro agent activate analyst "请分析当前问题并设计新方案"

# 手动激活方案执行者
kiro agent activate executor "请实现已通过的方案"

# 手动激活质检者
kiro agent activate inspector "请评估当前方案/训练结果"
```

### 紧急重置
```bash
# 重置Hook系统
kiro hook stop prism-workflow
kiro hook start prism-workflow

# 重置Agent状态
kiro agent reset all
```

## 成功标准
- **技术指标**：所有测试集AUPR≥0.75
- **稳定性**：连续3次实验达标
- **效率**：总迭代轮数≤20轮
- **质量**：代码清晰，文档完整

## 联系支持
如遇到系统问题或需要人工干预，请：
1. 查看Hook执行日志
2. 检查Agent配置文件
3. 使用手动触发机制
4. 记录问题现象以便改进系统