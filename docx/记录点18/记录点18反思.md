# 记录点18 反思

## 失败结构定理
**训练-测试泛化差距的数学本质**：设 $f_\theta: \mathcal{X} \to \mathbb{R}$ 为模型，$\mathcal{D}_{\text{train}}$ 为训练分布，$\mathcal{D}_{\text{test}}$ 为测试分布。当前模型在经验风险 $\hat{R}_{\text{train}}(f_\theta)$ 上达到极小（AUPR ≈ 0.977），但在测试风险 $\hat{R}_{\text{test}}(f_\theta)$ 上显著退化（AUPR ≈ 0.684）。这表明：
1. **假设空间 $\mathcal{H}$ 的复杂度** 相对于训练样本数 $n$ 过高，导致 Rademacher 复杂度 $\hat{\mathfrak{R}}_n(\mathcal{H})$ 过大。
2. **分布偏移的 Wasserstein 距离** $W_1(\mathcal{D}_{\text{train}}, \mathcal{D}_{\text{test}})$ 未被模型的结构性约束所抵抗。
3. **不变性学习失败**：模型学到了细胞系特定的伪特征（spurious correlations），而非跨细胞系不变的核心互作机制。

数学表述：
$$
\underbrace{\hat{R}_{\text{test}}(f_\theta) - \hat{R}_{\text{train}}(f_\theta)}_{\text{泛化差距}} \geq \underbrace{C \cdot \hat{\mathfrak{R}}_n(\mathcal{H})}_{\text{复杂度项}} + \underbrace{\lambda \cdot W_1(\mathcal{D}_{\text{train}}, \mathcal{D}_{\text{test}})}_{\text{分布偏移项}} - \underbrace{\Delta_{\text{inv}}}_{\text{不变性增益}}
$$
当前 $\Delta_{\text{inv}} \approx 0$，不变性机制缺失。

## 根因分析
### 数学层面
1. **优化景观的病态曲率**：损失函数的 Hessian 谱在训练分布上呈现尖锐最小值（sharp minimum），而在测试分布上该最小值变为鞍点或局部极大值。尖锐最小值对参数扰动敏感，泛化能力差。
2. **表征几何坍缩**：增强子-启动子对的序列嵌入在训练细胞系上线性可分，但在测试细胞系上类间距离收缩、类内距离膨胀，导致度量结构失效。
3. **信息瓶颈过早激活**：模型在早期层就丢弃了对于不变性预测必要但变异度高的特征，保留了低变异但非因果的伪相关。

### 算法层面
从日志和配置推断，记录点18可能沿用**能量耗散框架**（$U_I - R_E$）与**域对抗训练**。失败原因：
- **对抗训练的不完全博弈**：梯度反转层（GRL）迫使主干消除细胞系信息，但判别器可能太弱或太强，导致要么信息消除不彻底（残留伪相关），要么消除过度（丢失必要生物学信号）。
- **能量分解的物理错误**：内势 $U_I$ 与环境阻抗 $R_E$ 的建模未遵循真实生物物理约束（如热力学波动耗散定理），导致分解任意，无法保证跨细胞系的不变性。
- **损失函数的多目标冲突**：EP损失、正交损失、域损失、稀疏损失同时优化，可能陷入帕累托前沿的平庸点，各目标梯度相互抵消。

### 生物学层面
1. **忽视染色质三维结构的保守性**：EP互作在进化上受染色质拓扑关联域（TAD）约束，而当前纯序列模型未注入此拓扑先验。
2. **转录因子结合位点（TFBS）的上下文依赖**：同一TFBS在不同细胞系可能因表观修饰而功能迥异，模型未显式建模此修饰语境。
3. **细胞系特异的共调控模块**：模型可能将共现但非因果的调控模块误判为因果，因为这些模块在训练细胞系中恰好共现。

## 关键洞察
1. **泛化差距的量化**：训练AUPR 0.977 → 测试AUPR 0.684，绝对差距0.293，相对下降30%。这表明模型严重过拟合训练细胞系的特定模式。
2. **Recall-Precision 失衡**：Recall (0.4987) 显著低于 Precision (0.7135)，说明模型偏保守，对正例识别不足，倾向避免假阳性。这可能是能量公式中 $R_E$ 被高估，导致阈值整体右移。
3. **最优阈值极低 (0.01)**：模型输出的概率值整体偏低，需极低阈值才能达到最优F1。暗示概率校准失败，输出未匹配真实后验。

## 对下一步的启示
1. **必须引入结构性的不变性归纳偏置**：不能仅靠对抗训练，需在架构层面强制模型分离细胞系变异与核心互作信号。
2. **重新审视能量分解的物理基础**：$U_I$ 与 $R_E$ 的建模应受热力学约束（如波动-耗散关系），确保分解唯一且可解释。
3. **利用生物拓扑先验**：将染色质接触频率（Hi-C）或保守的TAD边界作为图结构注入，引导模型关注空间邻近的EP对。
4. **探索因果干预训练**：通过数据增强模拟“同一序列在不同细胞系”的干预，强制模型学习细胞系不变特征。