## 失败结构定理

记录点21的失败揭示了能量耗散系统中的一个根本性矛盾：**当 U_I 和 R_E 的优化缺乏严格的几何约束时，模型会收敛到一个“伪解耦”状态，其中 U_I 吸收了环境特异性信息，而 R_E 退化为微不足道的常数，导致在未知细胞系上丧失排序能力**。

数学上，这等价于在优化问题：

\[
\min_{f_\theta, g_\phi} \mathbb{E}_{(x,c,y)} \left[ \mathcal{L}\left( \sigma\left( \frac{f_\theta(x) - g_\phi(c)}{T} \right), y \right) \right]
\]

中，存在一个局部最优解满足 \( \nabla_\theta g_\phi(c) \approx 0 \) 且 \( f_\theta(x) \) 近似拟合了 \( y + g_\phi(c) \) 的混合信号。该解对应的 Hessian 矩阵在 \( g_\phi \) 方向上平坦，梯度下降难以逃离。

## 根因分析

### 数学层面

1. **表示纠缠的梯度证据**：从训练日志可见，训练集 AUPR 快速升至 0.95+，而验证集（未知细胞系）表现停滞。这表明损失函数的梯度主要来自 \( f_\theta \) 对细胞系特异性模式的拟合，而非学习跨细胞系不变的 \( U_I \)。互信息 \( I(f_\theta(X); C) \) 未得到有效压制。

2. **优化景观的平庸吸引子**：能量公式 \( (U_I - R_E)/T \) 在 \( R_E \) 接近常数时退化为标准的二分类逻辑回归，此时模型仅依靠 \( U_I \) 做出预测。由于训练数据中细胞系标签与目标相关，模型自然选择忽略 \( R_E \) 的更新，陷入一个损失较低但泛化性能差的吸引子。

3. **温度参数的失调**：可学习的温度 \( T \) 在训练中可能变得过小，导致 sigmoid 饱和，概率分布极化。这使得模型对 \( R_E \) 的小变化不敏感，进一步削弱了环境纠偏机制。

### 算法层面

1. **批次采样的随机性**：尽管记录了“纯随机批次”，但未强制同细胞系样本组成支持集，导致 Student 模块无法获得纯净的环境上下文。Batch 内细胞系混合使得环境估计退化为全局平均，丢失了细胞系特异性。

2. **U_I 与 R_E 的梯度路径未隔离**：在反向传播中，任务损失的梯度同时更新 \( f_\theta \) 和 \( g_\phi \)，且没有硬性约束阻止 \( f_\theta \) 学习环境信息。对抗训练（GRL）可能权重不足或方向错误，未能有效剥离环境信息。

3. **支持集表示过于简单**：环境编码器可能仅使用细胞系 ID 嵌入或简单的池化，未能捕捉细胞系内部的分布多样性。对于未知细胞系，这种简化的表示无法泛化。

### 生物学层面

1. **违背转录调控的层次性**：在真实生物学中，增强子-启动子互作首先由序列特征（转录因子结合位点）决定可能性，然后由细胞类型特定的染色质状态、组蛋白修饰等环境因素调节。当前模型未能强制这种层次性，允许序列特征“偷懒”直接编码环境信号。

2. **忽视细胞系间的进化保守性**：跨细胞系共享的序列模式应具有更高的进化保守性，而环境特异性调节则更多变。模型未利用这种先验，导致学到的 \( U_I \) 不稳定。

## 关键洞察

1. **解耦需要几何强制，而非仅仅损失约束**：单纯通过损失函数（如正交损失、对抗损失）鼓励解耦是软约束，容易被主导任务损失的梯度淹没。需要在表示空间引入硬结构性偏置，例如通过对比学习将同一细胞系的 \( U_I \) 表示拉近，不同细胞系的推远。

2. **环境估计必须依赖纯净的支持集**：推理时的环境阻抗估计必须来自同一细胞系的样本集合，训练时应模拟这种设置，采用 episodic 采样而非随机混合。

3. **温度应作为超参数或受严格正则**：温度 \( T \) 控制着能量尺度的敏感性，不宜自由学习。应将其固定或施加强先验（如 \( T \sim \text{Gamma}(2,1) \)），防止饱和。

## 对下一步的启示

1. **转向对比解耦架构**：设计一个双分支编码器，分别产生序列特征和环境特征，并施加对比损失迫使它们分离。

2. **实施细胞系内聚类与细胞系间分离**：在序列特征空间，最大化同一细胞系样本的相似度，最小化不同细胞系样本的相似度。这对应一个最大均值差异（MMD）或 InfoNCE 目标。

3. **引入课程学习**：先训练序列编码器（冻结环境编码器）学到初步的跨细胞系排序能力，再联合微调，避免两者同时陷入平庸解。

4. **采用原型网络进行环境估计**：为每个细胞系维护一个可更新的原型向量，环境编码器将支持集样本映射到该原型附近。未知细胞系的环境阻抗通过其支持集样本与原型的距离计算。

记录点21的失败并非能量耗散思想的失败，而是其工程实现未能满足必要的数学条件。下一步方案必须从表示几何的角度重新设计解耦机制。