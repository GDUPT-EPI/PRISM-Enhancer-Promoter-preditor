# 记录点19 方案：拓扑不变能量耗散网络 (Topologically Invariant Energy Dissipation Network, TIED-Net)

## 核心洞察（一句话）
**EP互作的本质是染色质三维空间中的拓扑邻近事件，其概率应由序列亲和力（内势$U_I$）与细胞系特异的拓扑可及性（拓扑阻抗$R_T$）共同决定，且后者在进化上具有跨细胞系的保守结构。**

## 问题的数学形式化
设 $x = (s_e, s_p)$ 为增强子-启动子序列对，$c$ 为细胞系标签。真实互作标签 $y \in \{0,1\}$。目标：学习 $P(y=1 | x, c)$。

当前能量框架：$P(y=1) = \sigma((U_I(x) - R_E(c)) / T)$，其中 $R_E(c)$ 为环境阻抗，仅依赖 $c$。

**根本缺陷**：$R_E(c)$ 忽略序列 $x$ 在细胞系 $c$ 中的**局部染色质拓扑环境**。同一序列在不同细胞系可能因染色质折叠差异而可及性不同。

新框架引入**拓扑阻抗** $R_T(x, c)$，分解为：
$$
R_T(x, c) = \underbrace{R_{\text{base}}(c)}_{\text{全局基线}} + \underbrace{R_{\text{topo}}(x, c)}_{\text{局部拓扑}}
$$

其中 $R_{\text{topo}}(x, c)$ 由**保守的染色质接触图**与**细胞系特异的表观修饰**共同调制。

## 解决方案
### 数学描述
1. **拓扑图构建**：基于保守的TAD边界和Hi-C接触频率，构建基因组位置的图 $G = (V, E)$，顶点 $v \in V$ 为基因组区间，边权重 $w_{ij}$ 反映跨细胞系平均的接触频率。
2. **拓扑嵌入**：对每个EP对 $x = (s_e, s_p)$，提取其基因组坐标 $(l_e, l_p)$，在 $G$ 上计算：
   - 最短路径距离 $d_G(l_e, l_p)$
   - 图扩散核 $K_G(l_e, l_p) = \exp(-\beta d_G(l_e, l_p))$
3. **拓扑阻抗模型**：
   $$
   R_{\text{topo}}(x, c) = -\log \left[ K_G(l_e, l_p) \cdot A_c(l_e) \cdot A_c(l_p) \right]
   $$
   其中 $A_c(l)$ 为细胞系 $c$ 在位置 $l$ 的表观可及性（从DNase-seq或ATAC-seq估计，若缺失则用可学习参数替代）。
4. **不变性约束**：强制模型对细胞系变异因子 $\epsilon_c$ 满足：
   $$
   \frac{\partial P(y=1 | x, c)}{\partial \epsilon_c} = 0 \quad \forall c
   $$
   通过梯度惩罚实现。

### 核心机制
1. **拓扑先验注入**：保守接触图 $G$ 提供跨细胞系不变的物理约束，引导模型关注空间邻近的EP对，降低在远距离对上浪费容量。
2. **细胞系特异性调制**：表观可及性 $A_c(l)$ 以乘法方式调制拓扑邻近的效应，反映“同一基因组位置在不同细胞系可能因染色质开放程度不同而功能迥异”。
3. **能量分解的唯一性保证**：通过引入拓扑图 $G$ 这一外部客观结构，$U_I$ 与 $R_T$ 的分解不再任意——$U_I$ 必须解释 $G$ 无法解释的剩余互作信号，从而避免平凡分解。

### 物理/生物对应
- **内势 $U_I$**：对应转录因子与DNA序列的特异性结合自由能，由碱基序列决定。
- **拓扑阻抗 $R_T$**：对应染色质纤维的折叠能垒，将空间上远离的EP对物理隔离；表观可及性 $A_c(l)$ 对应局部核小体占据或组蛋白修饰状态，调制该能垒。
- **整体框架**：类比化学反应速率 $k \propto \exp(-(E_a - \Delta G)/k_B T)$，其中 $E_a$ 为能垒（拓扑阻抗），$\Delta G$ 为反应驱动力（内势）。

## 架构设计
1. **拓扑图模块**：预计算全基因组的保守接触图 $G$（可从公开Hi-C数据整合），存储为稀疏邻接矩阵。
2. **坐标映射器**：将序列 $s_e, s_p$ 映射回基因组坐标 $(l_e, l_p)$（需数据集中包含坐标信息）。
3. **拓扑特征提取器**：计算 $d_G$, $K_G$，并与序列嵌入拼接。
4. **可及性估计器**：小型MLP，输入细胞系ID和位置 $l$，输出 $A_c(l)$（若无可及性数据，则退化为可学习的细胞系-位置查找表）。
5. **能量头**：$U_I$ 由现有FourierEnergyKAN生成，$R_T$ 由拓扑特征与可及性估计器生成，最终概率 $P = \sigma((U_I - R_T)/T)$，温度 $T$ 可学习。
6. **不变性惩罚**：在损失中加入梯度惩罚项 $\lambda \cdot \mathbb{E}_c \left[ \|\nabla_{\epsilon_c} P\|^2 \right]$。

## 理论优势
1. **降低Rademacher复杂度**：拓扑先验 $G$ 约束了假设空间，排除违背空间邻近的假设，缩小 $\hat{\mathfrak{R}}_n(\mathcal{H})$。
2. **减小分布偏移影响**：$G$ 是跨细胞系保守的，提供不变性锚点，降低 $W_1(\mathcal{D}_{\text{train}}, \mathcal{D}_{\text{test}})$ 的有效值。
3. **可解释性**：$U_I$ 与 $R_T$ 的分解对应明确的生物物理量，便于后续分析。

## 实施考量
- 若坐标信息缺失，可用序列嵌入的相似性近似拓扑邻近（假设相似序列在基因组上邻近）。
- 可及性估计器可先用公开表观数据预训练，再微调。
- 梯度惩罚需小心调参，避免过度约束。