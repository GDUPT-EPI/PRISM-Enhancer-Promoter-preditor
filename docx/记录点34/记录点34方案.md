# 记录点34方案：PAM-Graph (Phase-Aligned Mechanism Network on Graph)

## 1. 核心哲学：从“欧氏空间拟合”转向“复数流形推演”

### 1.1 深度问题诊断：线性简并与流形断裂 (Manifold Rupture)
历史方案（如记录点 6、32、33）在面对 OOD（未见细胞系）时，本质上遭遇了**“欧几里得空间的坐标漂移”**：
*   **线性简并 (Linear Degeneracy)**：在 $U_I - R_E$ 的加法框架下，环境阻尼 $R_E$ 沦为分类器的偏置（Bias）。优化器可以通过无限增大特征模长 $\|\mathbf{h}\|$ 来轻易抵消 $R_E$ 的影响。这种“软约束”允许模型在已知细胞系上通过调整局部坐标系达到 AUPR=0.70，但它并没有学到真正的调控机制，导致 OOD 时因为缺乏绝对参考系而失效。
*   **统计平凡解的局限**：传统的“富集分析”或“二阶矩匹配”本质上是在寻找分布的重心。在稀疏证据支持集 $S$ 下，重心极易受噪声样本偏移，且无法捕捉到生物调控中**“机制切换（Mechanism Switching）”**的离散突变特性。
*   **解耦失效**：如果环境特征 $z_c$ 与序列特征 $z_{seq}$ 在同一欧氏空间，两者必然会发生隐式的线性耦合，导致模型学到的是伪相关而非因果律。

### 1.2 物理内核：极坐标解耦与干涉逻辑 (Phase-Interference Logic)
借鉴旋转位置编码 (RoPE) 的几何本质，我们将调控建模为**复数域的相位干涉**。
*   **对称性守恒**：在极坐标系中，环境的变化被建模为**相位旋转（Rotation）**。旋转是单位圆上的等距变换（Isometry），它天然保证了特征流形在跨细胞系迁移时的几何不变量（Invariant）。
*   **硬性物理约束**：利用 $\cos(\Delta\theta)$ 的周期性与有界性，强制封锁了优化器通过“线性外推”或“数值爆炸”作弊的路径。调控不再是权重的堆叠，而是波的**相干（Constructive）与相消（Destructive）**。

---

## 2. 数学架构设计：PAM-Graph

### 2.1 极坐标特征映射 (Polar Decoupling Mapping)
主干网络提取的特征 $h \in \mathbb{R}^D$ 被重构为复数向量序列 $\mathbf{z} \in \mathbb{C}^{D/2}$。对于每一对分量 $(x_{2j}, x_{2j+1})$：
$$z_j = r_j e^{i\phi_j}, \quad \text{where } r_j = \sqrt{x_{2j}^2 + x_{2j+1}^2 + \epsilon}, \quad \phi_j = \text{atan2}(x_{2j+1}, x_{2j})$$
*   **幅值 $r_j$ (Intrinsic Capacity)**：代表序列内蕴的调控潜力，受 DNA 序列硬性约束，反映转录因子结合位点（TFBS）的物理亲和力，不随环境改变。
*   **相位 $\phi_j$ (Response Phase)**：代表序列对不同调控机制的响应“极性”。

### 2.2 机制振子图谱 (Mechanism Oscillator Graph, MOG)
定义全局共享的机制图 $\mathcal{G} = (\mathcal{V}, \mathcal{E})$，其中每个节点 $k$ 是一个**机制振子**：
*   **振子向量 $\mathbf{V}_k \in \mathbb{C}^{D/2}$**：定义了该机制在复空间中的基准相位分布。
*   **图拉普拉斯约束 $\mathbf{L}$**：机制间的连接边 $e_{uv}$ 定义了相位耦合系数 $\mathbf{A}_{uv}$，模拟不同反式作用因子（如转录因子复合体）间的协同或拮抗物理约束。

### 2.3 稠密信息压缩：相位感知器 (Phase-Perceiver)
针对 10k 全量无标签观测点 $X_{10k}$ 到 2048 个环境指纹（Fingerprints）的压缩，放弃不稳定的 Top-K 提取，采用非对称交叉注意力机制（Non-symmetric Cross-Attention）：

1.  **流形投影压缩 (Manifold Projection Compression)**：
    定义 2048 个可学习的复数潜变量作为查询向量 $Q_{slots} \in \mathbb{C}^{2048 \times d}$，对 10k 个观测点进行“指纹聚合”：
    $\mathbf{Z}_{2048} = \text{Softmax}\left(\frac{\text{Re}(Q_{slots} \cdot \mathbf{H}_{10k}^H)}{\sqrt{d}}\right) \mathbf{H}_{10k}$
    *   **解决稀疏性**：每个指纹槽位（Slot）都是全量 10k 观测点的加权复数汇总，消除了 Top-K 的离散噪声。
    *   **相位保真**：在复数域进行聚合，确保了相位信息（环境信号）在压缩过程中不发生相消干涉导致的均值湮灭。

2.  **指纹与机制的对映关系 (2048 $\to$ 64)**：
    *   **2048 指纹槽 (Observer)**：代表当前细胞系环境的“感官摘要”，是动态的、数据驱动的。
    *   **64 机制节点 (Interrogator)**：代表生物调控的“逻辑原子”（如特定的 TF 复合体逻辑），是静态的、先验知识驱动的。
    *   **交互逻辑**：64 个机制振子 $\mathcal{V}_{MOG}$ 通过注意力机制“询问” 2048 个指纹槽，计算各自的**局部一致性相位**：
        $\theta_k = \text{Arg}(\sum_{m=1}^{2048} \alpha_{k,m} \cdot \mathbf{z}_m), \quad \alpha_{k,m} \text{ 为机制对指纹的感应强度}$

### 2.4 非线性相位感应器 (Non-linear Phase Sensor, NPS)
基于压缩后的 $\mathbf{Z}_{2048}$ 进行群体相位锁定：
1.  **群体相位锁定 (Global Phase-locking)**：
    利用 MUSIC (Multiple Signal Classification) 算法的变体，在 2048 个指纹中提取主导环境频率：
    $\theta_c = \text{ArgMax}_{\theta} \frac{1}{\mathbf{e}(\theta)^H \mathbf{E}_n \mathbf{E}_n^H \mathbf{e}(\theta)}$
    其中 $\mathbf{E}_n$ 为指纹协方差矩阵的噪声子空间投影。这保证了即使在极度 OOD 的环境下，也能锁定最稳健的环境相位。

2.  **机制吸引子动力学 (Mechanism Attractor Dynamics)**：
    利用 Kuramoto 模型，将 $\theta_c$ 耦合到机制图 $\mathcal{G}$：
    $\frac{d\theta_c}{dt} = \omega_c + \frac{K}{N} \sum_{k=1}^{64} A_{ck} \sin(\theta_k - \theta_c)$
    强制环境推断结果向 64 个机制定义的“合法吸引子”塌陷，防止推断出生物学上不可能存在的中间态。

### 2.5 架构思考：为什么不使用类 LLM 的序列压缩？
*   **LLM 的线性本质**：大模型（Transformer）的压缩（如 KV Cache 或长文本摘要）本质上是基于**时间/位置序列**的线性坍缩。它假设信息是流式的、有前后因果的。
*   **PRISM 的拓扑本质**：生物调控是**非线性的、关系驱动的**。10k 个序列不是序列，而是“支持集”。
*   **图结构的必要性**：64 个机制之间的关系是相对稳定的物理约束（如 TF-A 必须与 TF-B 结合才能起效）。图结构能将这种“逻辑不变量”编码进网络拓扑，而序列压缩会丢失这种跨细胞系的**物理因变量约束**。

### 2.6 相位干涉调制层 (Phase-Interference Modulation, PIM)
实现物理级的非线性门控：
$$h_{mod} = \sum_{j=1}^{D/2} r_j \cdot \mathcal{F}(\phi_j, \theta_c), \quad \mathcal{F} = \alpha \cos(\phi_j + \theta_c) + \beta \cos(2\phi_j + \theta_c)$$
*   **逻辑内核**：$\cos(\Delta\theta)$ 项实现了类似“与门”的相干逻辑。
*   **高阶项**：$2\phi_j$ 项捕捉了复杂的顺式作用元件（cis-elements）之间的非线性干涉模式。

---

## 4. 优化目标与硬约束 (Refined Training Objective)

### 4.1 复数域变分下界 (Complex-ELBO)
$\mathcal{L}_{PAM} = \mathbb{E}_{q(\theta_c|S)} [ \log P(y | \mathbf{z}, \theta_c) ] - \lambda_{KL} \cdot \text{KL}(q(\theta_c | S) \| p(\theta; \mathcal{G}))$
*   **先验约束 $p(\theta; \mathcal{G})$**：环境相位必须遵循机制图 $\mathcal{G}$ 定义的玻尔兹曼分布，确保推断出的环境状态在生物学上是合法的（即符合已知的调控网络拓扑）。

### 4.2 相位同步正则化 (Synchronization Regularization)
$$\mathcal{L}_{sync} = \sum_{(u,v) \in \mathcal{E}} \mathbf{A}_{uv} [ 1 - \cos(\theta_u - \theta_v) ]$$
强制机制图上的振子保持物理相干性，防止模型在 OOD 推断时发生相位空间的“各向异性”碎裂。

---

## 5. 变量定义与物理映射表

| 符号 | 定义 | 数学性质 | 物理/生物含义 |
| :--- | :--- | :--- | :--- |
| $r_{seq}$ | **内蕴幅值** | 非负实数，环境不变性 | DNA 序列的结合亲和力上限（硬件）。 |
| $\phi_{seq}$ | **内蕴相位** | $[-\pi, \pi)$，旋转对称性 | 序列对特定机制的响应特征方向。 |
| $\theta_c$ | **环境相位** | 复流形上的动态变量 | 细胞系当前的转录因子/染色质环境状态（软件）。 |
| $\cos(\Delta\theta)$ | **干涉算子** | 有界性 $[-1, 1]$，周期性 | 模拟物理上的相干/相消，实现逻辑开关。 |
| $\mathcal{G}(\mathbf{A})$ | **机制振子图** | 拓扑约束，非欧流形 | 生物调控网络中机制间的固有博弈/协同规则。 |

---

## 6. 为什么 PAM-Graph 能突破 0.75 瓶颈？

1.  **从“外推”到“等距变换”**：
    在线性空间中，未见细胞系是一个无限的外推问题，数值极易失控。在 PAM 框架下，所有环境都被映射到单位圆上的**旋转**。由于旋转是保模变换，OOD 环境只是一个**新的旋转角度**，在流形上依然处于“已见”的旋转轨道内。
2.  **相位锁死的压强**：
    $\cos$ 函数在相干点附近的梯度极大，而在相消区域（相位差 $> \pi/2$）几乎完全切断信号。这种**非线性压强**迫使模型必须精准捕捉相位对齐，无法通过“平均显著性”这种统计学手段糊弄。
3.  **无标签证据的深度利用**：
    2048 点全量观测不再是简单的均值统计，而是通过**群体相位同步算法**，从统计噪声中提取出高纯度的环境干涉指纹（Interference Fingerprint）。

---

## 7. 结论
PAM-Graph 方案通过**复数域极坐标解耦**，建立了一套严密的生物物理推演框架。它利用相位干涉作为逻辑内核，通过机制振子图实现拓扑约束，彻底解决了 OOD 环境下的简并与失效难题。这不再是数据的拟合，而是对**调控动力学不变量**的深刻建模，是跨越 0.75 AUPR 瓶颈的必然路径。
