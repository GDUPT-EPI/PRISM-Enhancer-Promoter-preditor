# 记录点34方案：Meta-ERM (Meta-learning based Episodic Reconstruction & Modulation)

## 1. 核心哲学：从“特征记忆”转向“富集推演”

### 1.1 痛点回顾与反思
项目在记录点6之后的停滞，本质上源于一个生物学与机器学习的双重误区：
1.  **静态环境误区**：之前的方案（记录点6-33）试图学习一个静态的环境参数 $M(c)$ 或 $R_E(c)$。然而，细胞系环境不是一个标签，而是一组活跃的生物机制。
2.  **二分法悖论**：将特征简单分为“环境无关势能 $U_I$”和“环境调制因子 $M(c)$”不符合生物逻辑。在生物界，没有绝对环境无关的 Motif。一个特征在 A 细胞系是激活因子，在 B 细胞系可能是抑制因子，这取决于该环境下的 TF 富集与协同。
3.  **重建能力的缺失**：记录点34之前的方案假设模型能通过 ID “猜”出环境，导致 OOD 场景下由于 ID 失效，模型只能退化为平凡解（记录点4）。**真正的重建必须是在训练阶段就被赋予的“观察规律”的本能。**

### 1.2 记录点34的核心突破：动态富集推演
本方案提出 **"元学习驱动的局部样本差分富集"**。模型不再试图“解耦”环境，而是学会像生物学家一样，通过观察一个细胞系的少量样本（Support Set），实时计算出该环境下的 **“特征极性（Feature Polarity）”**。

---

## 2. 理论模型：Meta-ERM 架构

### 2.1 动态推演方程
不再有固定的 $M(c)$，预测逻辑演变为基于支持集的条件推理：

$$ P(y=1 | x_q, S_c) = \sigma \left( \langle f(x_q), P_{enrich}(S_c) \rangle \cdot T(S_c) + B(S_c) \right) $$

其中：
*   $x_q$: 待预测的查询样本（Query Sample）。
*   $S_c = \{(x_i, y_i)\}_{i=1}^K$: 该细胞系的**支持集 (Support Set)**，包含正负样本。
*   $f(\cdot)$: 通用的特征提取器（Motif 识别机）。
*   $P_{enrich}(S_c)$: **环境特征极性向量**。通过对支持集进行差分富集计算：
    $$ P_{enrich} = \text{Agg}(\text{Positive Samples in } S_c) - \text{Agg}(\text{Negative Samples in } S_c) $$
    该向量实时捕获了当前环境下哪些特征是有利的，哪些是不利的。

### 2.2 为什么这符合生物逻辑？
*   **极性反转**：如果一个 Motif 在当前细胞系中由于抑制因子的存在而表现为负向，那么在 $S_c$ 的正样本中该特征会减少，负样本中增加，$P_{enrich}$ 对应维度会自动变为负值。
*   **动态解释**：同一个特征 $f(x)$ 在不同 $P_{enrich}$ 的作用下会产生截然不同的 Logit 贡献。

---

## 3. 训练范式：元学习 (Episodic Training)

为了让模型学会这种“重建能力”，必须改变训练方式：

### 3.1 任务采样 (Episode Sampling)
每个 Batch 不再是随机样本，而是一个完整的 **Task (Episode)**：
1.  从同一细胞系中采样 $N$ 个样本。
2.  **Split**: 随机选取 $K$ 个作为 **Support Set**（例如 16 个），剩余作为 **Query Set**。

### 3.2 强制依赖约束
*   **屏蔽 ID**: 严禁模型接触任何 Cell ID。
*   **唯一路径**: 模型预测 Query Set 的唯一信息来源是：`f(query_x)` 和由 `Support Set` 生成的 `P_enrich`。
*   **交换不变性 Loss**: 强制要求将 A 细胞系的 $P_{enrich}$ 作用于 B 细胞系的 Query 样本时，预测性能大幅下降。这确保 $P_{enrich}$ 捕获的是特异性富集特征，而非全局统计。

---

## 4. OOD 解决方案：内生的重建本能

遇到全新的 OOD 细胞系 $c_{new}$ 时：
1.  **不再盲目**: 模型不再通过 $M=1$ 躺平。
2.  **观察与适应**: 模型通过读取该细胞系的 16 个参考样本，瞬间生成该环境的 $P_{enrich}$。
3.  **实时应用**: 利用这个即时生成的“环境地图”，对该细胞系的所有样本进行高精度预测。

---

## 5. 总结

记录点34方案（Meta-ERM）标志着项目从 **“尝试剥离环境干扰”** 转向 **“利用局部富集规律重建环境”**。它不再追求一个虚幻的、绝对环境无关的 $U_I$，而是通过元学习架构，赋予了模型在未知领域通过少量观测实时建立“物理模型”的能力。这是解决 OOD 泛化、打破项目长期停滞的根本出路。
